spring: "1.0"

name: Cal.com Development Setup
description: Open-source scheduling platform - monorepo with Next.js, Prisma, PostgreSQL, and Redis

prerequisites:
  - name: Node.js (v18+)
    check: "node --version | grep -E \"v(18|19|20|21|22|23)\\.\" || (echo \"Node.js v18+ required\" && exit 1)"
    required: true
  - name: Yarn 3.4.1
    check: "yarn --version | grep \"^3\\.4\\.1$\" || (echo \"Yarn 3.4.1 required\" && exit 1)"
    required: true
  - name: Docker installed
    check: docker --version
    required: true
  - name: Docker daemon running
    check: docker info > /dev/null 2>&1
    required: true

steps:
  - name: Kill application port if in use
    run: npx kill-port 3000 || true
    optional: true
  - name: Copy .env.example to .env
    run: cp .env.example .env 2>/dev/null || true
  - name: Generate NEXTAUTH_SECRET
    run: "if ! grep -q \"^NEXTAUTH_SECRET=\" .env || grep -q \"^NEXTAUTH_SECRET=$\" .env || grep -q \"^NEXTAUTH_SECRET=\\\"\\\"$\" .env; then\n  SECRET=$(openssl rand -base64 32)\n  if grep -q \"^NEXTAUTH_SECRET=\" .env; then\n    sed -i.bak \"s|^NEXTAUTH_SECRET=.*|NEXTAUTH_SECRET='$SECRET'|\" .env\n  else\n    echo \"NEXTAUTH_SECRET='$SECRET'\" >> .env\n  fi\n  echo \"Generated NEXTAUTH_SECRET\"\nelse\n  echo \"NEXTAUTH_SECRET already set\"\nfi\n"
  - name: Generate CALENDSO_ENCRYPTION_KEY
    run: "if ! grep -q \"^CALENDSO_ENCRYPTION_KEY=\" .env || grep -q \"^CALENDSO_ENCRYPTION_KEY=$\" .env || grep -q \"^CALENDSO_ENCRYPTION_KEY=\\\"\\\"$\" .env; then\n  SECRET=$(openssl rand -base64 32)\n  if grep -q \"^CALENDSO_ENCRYPTION_KEY=\" .env; then\n    sed -i.bak \"s|^CALENDSO_ENCRYPTION_KEY=.*|CALENDSO_ENCRYPTION_KEY='$SECRET'|\" .env\n  else\n    echo \"CALENDSO_ENCRYPTION_KEY='$SECRET'\" >> .env\n  fi\n  echo \"Generated CALENDSO_ENCRYPTION_KEY\"\nelse\n  echo \"CALENDSO_ENCRYPTION_KEY already set\"\nfi\n"
  - name: Copy .env.appStore.example to .env.appStore
    run: cp .env.appStore.example .env.appStore 2>/dev/null || true
  - name: Install dependencies
    run: yarn install
    timeout: "15m"
  - name: Start Cal.com with yarn dx
    run: yarn dx
    background: true
    ready_when:
      type: http
      url: "http://localhost:3000"
      timeout: "300s"
